(()=>{var G=class{constructor(t){this.t=t,this.i=10**this.t}h(t){return this.t<16?Math.round(t*this.i)/this.i:t}o(t,e){return this.h(t)+","+this.h(e)}},E=class{constructor(t,e){this.x=t,this.y=e}u(){return new E(-this.x,-this.y)}l(t=1){return this._(t/(this.M()||1/0))}g(t){return new E(this.x+t.x,this.y+t.y)}v(t){return new E(this.x-t.x,this.y-t.y)}_(t){return new E(this.x*t,this.y*t)}m(t){return this.x*t.x+this.y*t.y}M(){return Math.sqrt(this.x*this.x+this.y*this.y)}p(t){let e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)}},k=class{constructor(t,e){this.C=t,this.L=e}},D=class{constructor(t,e){this.k=t,this.B=e}D(t){let e=this.k;this.B&&(e.unshift(e[e.length-1]),e.push(e[1]));let r=e.length;if(r===0)return[];let n=[new k(e[0])];return this.P(n,t,0,r-1,e[1].v(e[0]),e[r-2].v(e[r-1])),this.B&&(n.shift(),n.pop()),n}P(t,e,r,n,s,o){let i=this.k;if(n-r==1){let p=i[r],a=i[n],v=p.p(a)/3;return void this.R(t,[p,p.g(s.l(v)),a.g(o.l(v)),a])}let c=this.j(r,n),u,m=Math.max(e,e*e),l=!0;for(let p=0;p<=4;p++){let a=this.q(r,n,c,s,o),v=this.A(r,n,a,c);if(v.error<e&&l)return void this.R(t,a);if(u=v.index,v.error>=m)break;l=this.F(r,n,c,a),m=v.error}let h=i[u-1].v(i[u+1]);this.P(t,e,r,u,s,h),this.P(t,e,u,n,h.u(),o)}R(t,e){t[t.length-1].G=e[1].v(e[0]),t.push(new k(e[3],e[2].v(e[3])))}q(t,e,r,n,s){let o=1e-12,i=Math.abs,c=this.k,u=c[t],m=c[e],l=[[0,0],[0,0]],h=[0,0];for(let y=0,b=e-t+1;y<b;y++){let L=r[y],M=1-L,F=3*L*M,q=M*M*M,_=F*M,T=F*L,B=L*L*L,A=n.l(_),P=s.l(T),$=c[t+y].v(u._(q+_)).v(m._(T+B));l[0][0]+=A.m(A),l[0][1]+=A.m(P),l[1][0]=l[0][1],l[1][1]+=P.m(P),h[0]+=A.m($),h[1]+=P.m($)}let p=l[0][0]*l[1][1]-l[1][0]*l[0][1],a,v;if(i(p)>o){let y=l[0][0]*h[1]-l[1][0]*h[0];a=(h[0]*l[1][1]-h[1]*l[0][1])/p,v=y/p}else{let y=l[0][0]+l[0][1],b=l[1][0]+l[1][1];a=v=i(y)>o?h[0]/y:i(b)>o?h[1]/b:0}let f=m.p(u),g=o*f,x,w;if(a<g||v<g)a=v=f/3;else{let y=m.v(u);x=n.l(a),w=s.l(v),x.m(y)-w.m(y)>f*f&&(a=v=f/3,x=w=null)}return[u,u.g(x||n.l(a)),m.g(w||s.l(v)),m]}F(t,e,r,n){for(let s=t;s<=e;s++)r[s-t]=this.H(n,this.k[s],r[s-t]);for(let s=1,o=r.length;s<o;s++)if(r[s]<=r[s-1])return!1;return!0}H(t,e,r){let n=[],s=[];for(let h=0;h<=2;h++)n[h]=t[h+1].v(t[h])._(3);for(let h=0;h<=1;h++)s[h]=n[h+1].v(n[h])._(2);let o=this.I(3,t,r),i=this.I(2,n,r),c=this.I(1,s,r),u=o.v(e),m=i.m(i)+u.m(c);return(l=m)>=-112e-18&&l<=112e-18?r:r-u.m(i)/m;var l}I(t,e,r){let n=e.slice();for(let s=1;s<=t;s++)for(let o=0;o<=t-s;o++)n[o]=n[o]._(1-r).g(n[o+1]._(r));return n[0]}j(t,e){let r=[0];for(let n=t+1;n<=e;n++)r[n-t]=r[n-t-1]+this.k[n].p(this.k[n-1]);for(let n=1,s=e-t;n<=s;n++)r[n]/=r[s];return r}A(t,e,r,n){let s=Math.floor((e-t+1)/2),o=0;for(let i=t+1;i<e;i++){let c=this.I(3,r,n[i-t]).v(this.k[i]),u=c.x*c.x+c.y*c.y;u>=o&&(o=u,s=i)}return{error:o,index:s}}},O=(d,t={})=>((e,r,n)=>{let s=e.length,o=new G(n),i,c,u,m,l=!0,h=[],p=(a,v)=>{let f=a.C.x,g=a.C.y;if(l)h.push("M"+o.o(f,g)),l=!1;else{let x=f+(a.L?.x??0),w=g+(a.L?.y??0);if(x===f&&w===g&&u===i&&m===c){if(!v){let y=f-i,b=g-c;h.push(y===0?"v"+o.h(b):b===0?"h"+o.h(y):"l"+o.o(y,b))}}else h.push("c"+o.o(u-i,m-c)+" "+o.o(x-i,w-c)+" "+o.o(f-i,g-c))}i=f,c=g,u=f+(a.G?.x??0),m=g+(a.G?.y??0)};if(!s)return"";for(let a=0;a<s;a++)p(e[a]);return r&&s>0&&(p(e[0],!0),h.push("z")),h.join("")})(new D(d.map(e=>new E(e[0],e[1])),t.closed).D(t.tolerance??2.5),t.closed,t.precision??5);var S=class{constructor(t,e){this.path=t;this.distanceThreshold=e?.distanceThreshold??4,this.inertiaFactor=e?.inertiaFactor??.1,this.tolerance=e?.tolerance??2.5,this.precision=e?.precision??5}distanceThreshold;inertiaFactor;tolerance;precision;points=[];wma;_d="";add({x:t,y:e}){let{path:r,points:n,wma:s}=this;if(s){let[o,i]=this.wma=[(s[0]+t)*.5,(s[1]+e)*.5],[c,u]=n[n.length-1],m=Math.hypot(o-c,i-u);if(m>this.distanceThreshold){if(n.length>3){let[l,h]=n[n.length-3],[p,a]=n[n.length-2],v=Math.hypot(c-p,u-a)*this.inertiaFactor,f=v/Math.hypot(p-l,a-h),g=v/m;this._d+=`C${p+(p-l)*f} ${a+(a-h)*f} ${c+(c-o)*g} ${u+(u-i)*g} ${c} ${u}`}r.setAttribute("d",`${this._d}L${o} ${i}`),n.push([o,i])}}else{let o=10**this.precision,i=c=>Math.round(c*o)/o;r.setAttribute("d",`${this._d=`M${i(t)} ${i(e)}`}v0`),n.push(this.wma=[t,e])}return this}end(){let{path:t}=this,e=t.getTotalLength();if(e!==0){let r=[],n=Math.max(.2,Math.min(8,e*.01));for(let o=0;o<e;o+=n){let i=t.getPointAtLength(o);r.push([i.x,i.y])}let s=t.getPointAtLength(e);r.push([s.x,s.y]),t.setAttribute("d",O(r,{tolerance:this.tolerance,precision:this.precision}))}return this}};var C=d=>{let t=d.target.closest("svg[data-fluentpath]"),e={},r=t?.getAttribute("data-fluentpath");if(r)for(let n of r.split(";")??[]){let s=n.indexOf(":"),o=n.slice(0,s).trim().replace(/[a-zA-Z0-9_]-[a-z]/g,i=>i[0]+i[2].toUpperCase());o&&(e[o]=+n.slice(s+1).trim())}return[t,e]},I=(()=>{let d=document.createElementNS("http://www.w3.org/2000/svg","circle");return d.setAttribute("stroke","none"),d.setAttribute("fill","red"),d.setAttribute("r","3"),d.setAttribute("opacity","0.2"),d.style.transition="opacity 8s ease-out",t=>{let e=d.cloneNode();return e.setAttribute("cx",t.x),e.setAttribute("cy",t.y),t.color&&e.setAttribute("fill",t.color),requestAnimationFrame(()=>e.setAttribute("opacity","0.04")),setTimeout(()=>e.remove(),16e3),e}})();addEventListener("pointerdown",d=>{if(d.button!==0)return;let[t,e]=C(d);if(!t)return;let r=t.getScreenCTM().inverse(),n=h=>{let p=new DOMPoint(h.clientX,h.clientY).matrixTransform(r);return t.appendChild(I(p)),p},s=document.createElementNS("http://www.w3.org/2000/svg","path"),o=new S(s,e).add(n(d));console.log(new Date().toISOString().replace(/.*T(.*)Z/,(h,p)=>p),o);let i=h=>{let{points:p}=o,a=p.length;if(o.add(n(h)),p.length>a){let[v,f]=p[p.length-1];t.appendChild(I({x:v,y:f,color:"blue"}))}},c=h=>{l(),o.add(n(h)).end(),s.dispatchEvent(new CustomEvent("fluentpath:drawend",{bubbles:!0}))},u=h=>h.keyCode===27&&m(),m=()=>{l(),s.remove()},l=()=>{removeEventListener("pointerdown",m,!0),removeEventListener("pointermove",i),removeEventListener("pointerup",c,!0),removeEventListener("pointercancel",m,!0),removeEventListener("keydown",u)};addEventListener("pointerdown",m,!0),addEventListener("pointermove",i),addEventListener("pointerup",c,!0),addEventListener("pointercancel",m,!0),addEventListener("keydown",u),t.appendChild(s).dispatchEvent(new CustomEvent("fluentpath:drawstart",{bubbles:!0})),d.preventDefault()},{passive:!1});"GestureEvent"in self&&(addEventListener("touchmove",d=>d.touches.length===1&&C(d)&&d.preventDefault(),{passive:!1}),addEventListener("touchend",d=>C(d)&&d.preventDefault(),{passive:!1}));})();
